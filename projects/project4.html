<!doctype html>
<html class="no-js" lang="japanese">
<head>
      <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>My Portfolio - ローカル LLM で大量の英文をセキュアに翻訳する</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Serif+Pro:400,700">
    <link rel="stylesheet" type="text/css" href="https://yt-pf.github.io/portfolio/theme/css/main.css">


</head>
<body itemscope itemtype="http://schema.org/Blog">
<header class="site-header">
    <a href="https://yt-pf.github.io/portfolio">
    </a>
    <h1 itemprop="name"><a href="https://yt-pf.github.io/portfolio">My Portfolio</a></h1>
</header>
    <section class="main-content">
  <article>
    <header>
      <h2>ローカル LLM で大量の英文をセキュアに翻訳する</h2>
    </header>
    

    <h3>概要</h3>
<p>大量の英語テキストを社内・プライベート環境で翻訳したいが、外部 API（DeepL など）は次のような制約がある。</p>
<table>
<thead>
<tr>
<th>制約</th>
<th>影響</th>
</tr>
</thead>
<tbody>
<tr>
<td>API 使用上限</td>
<td>大規模データの一括翻訳が困難</td>
</tr>
<tr>
<td>プライバシー懸念</td>
<td>機密文書や著作権保護されたテキストを外部サーバへ送信できない</td>
</tr>
<tr>
<td>コスト</td>
<td>高頻度利用で料金が急増</td>
</tr>
</tbody>
</table>
<p>また、翻訳アーキテクチャには Encoder-Decoder モデルなどもあるが、精度には疑問符がついた。</p>
<p>本プロジェクトは ローカル LLM を用いて、完全オフラインの環境で英語 → 日本語翻訳を実現する。</p>
<h4>目標</h4>
<ul>
<li>プライバシー保護<ul>
<li>データは全てローカルマシン上に留まり、外部に送信しない。</li>
</ul>
</li>
<li>コスト削減<ul>
<li>無料のオープンモデルを活用し、API 利用料を排除。</li>
</ul>
</li>
<li>実務レベルの精度<ul>
<li>7B ～ 13B パラメータのモデルと適切なプロンプト設計で、商用翻訳サービスに匹敵する品質を目指す。</li>
</ul>
</li>
</ul>
<h4>メリット</h4>
<table>
<thead>
<tr>
<th>項目</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>プライバシー</td>
<td>完全オフライン、データはローカルに保存</td>
</tr>
<tr>
<td>コスト</td>
<td>オープンソースモデルは無料、電気代のみ課金</td>
</tr>
<tr>
<td>柔軟性</td>
<td>任意のモデルを ollama pull で取得、プロンプトだけでタスク切替可</td>
</tr>
<tr>
<td>拡張性</td>
<td>将来的に LoRA 微調整や自前データでファインチューニングが容易</td>
</tr>
</tbody>
</table>
<h4>デメリット</h4>
<table>
<thead>
<tr>
<th>デメリット</th>
<th>対応策</th>
</tr>
</thead>
<tbody>
<tr>
<td>大容量メモリが必要</td>
<td>適切なモデルサイズの選定やモデルの量子化で対応</td>
</tr>
<tr>
<td>翻訳品質はモデル依存</td>
<td>複数モデルで検証し、最適モデルを選択。必要に応じてプロンプトエンジニアリングや LoRA 微調整</td>
</tr>
<tr>
<td>インストール手順が多少複雑</td>
<td>Linux や Mac では CLI から Ollama のインストールが可能</td>
</tr>
<tr>
<td>GPU が無い場合は遅くなる</td>
<td>CPU 推論でも動作可能。ただしバッチサイズを小さめに設定し、時間が許容範囲か確認</td>
</tr>
</tbody>
</table>
<h3>使用ライブラリ</h3>
<ul>
<li>Ollama</li>
<li>spaCy</li>
</ul>
<h3>プロンプトテンプレート</h3>
<p>次のサイトから先人の知恵をお借りして、以下のプロンプトを使用する。必要であれば調整する。</p>
<ul>
<li><a href="https://qiita.com/u1and0/items/fea9984df0eb7f881934">オープン LLM を使用したセキュアな翻訳サイトをオンプレ環境で立ててみた</a></li>
</ul>
<div class="highlight"><pre><span></span><code>指示：
- 英語が入力された場合、日本語で出力してください。
- 出力は自然な母国語の話者のように表現してください。
- 出力形式は入力形式を忠実に再現してください。
- 冗長な表現や不適切な言い回しは適切に修正してください。
- JTF日本語標準スタイルガイドに従い、文法的に正しい自然な文章にし、句読点を適切に追加してください。
- 不明な言葉があれば質問してください。
- (最重要要件)出力をそのままコピーペーストするので不要な情報は含めず、結果の出力のみ行ってください。
</code></pre></div>

<h3>想定する動作環境</h3>
<ul>
<li>ローカル LLM を実行できる環境<ul>
<li>Python</li>
<li>Jupyter Notebook</li>
<li>Ollama</li>
<li>外部にデータを送信してもよい場合は、Google Colab</li>
</ul>
</li>
<li>GPU が搭載されている場合は NVIDIA ドライバ + CUDA 11.8 以上がインストール済み</li>
<li>Ubuntu 環境を想定しているが、他の OS でも動作可能</li>
</ul>
<h3>実行例</h3>
<p>このページの一番下を参照。</p>
<h3>今後の課題</h3>
<ul>
<li>評価指標について<ul>
<li>BLEU スコアが一般的だが、欠点もあるため、他の指標や、人間の評価を組み合わせ、品質を総合的に把握。</li>
</ul>
</li>
<li>LoRA 微調整<ul>
<li>業界特化ドメイン（医療、法務等）のデータで追加学習し、専門用語の正確性を向上。</li>
</ul>
</li>
<li>インタラクティブ UI<ul>
<li>今回はバッチ処理を想定しているが、Streamlit などで簡易翻訳 Web UI を提供するとユーザビリティ向上に繋がる。</li>
</ul>
</li>
</ul>
<h3>実行方法</h3>
<ol>
<li>Jupyter Notebook でファイルを開く</li>
<li>1 セル目, 2 セル目の設定項目を編集する</li>
<li>全セルを順に実行</li>
</ol>
<h3>ファイル</h3>
<p><a href="https://yt-pf.github.io/portfolio/pages/project4/batch-translate.ipynb">batch-translate.ipynb</a></p>
<p><a href="https://yt-pf.github.io/portfolio/pages/project4/sample_file.txt">サンプルのテキストファイル</a></p>
<h3>ライセンス</h3>
<p>使用する LLM モデルは各モデルのライセンス（例: Apache‑2.0, MIT, CC‑BY‑4.0 等）に従ってください。</p>
<h3>参考サイト</h3>
<ul>
<li><a href="https://qiita.com/u1and0/items/fea9984df0eb7f881934">オープン LLM を使用したセキュアな翻訳サイトをオンプレ環境で立ててみた</a></li>
<li><a href="https://zenn.dev/kaeru39/articles/fd903f61198818">7B 級のローカル LLM を用いた機械翻訳の出力比較</a></li>
<li><a href="https://zenn.dev/pythocial/articles/044fe58e0333f8">機械翻訳における BLEU スコアの落とし穴</a></li>
</ul>
<h3>サンプル</h3>
<p>著作権が切れた以下の文章をサンプルとして使う。</p>
<blockquote>
<p>To Sherlock Holmes she is always the woman. I have seldom heard him mention her under any other name. In his eyes she eclipses and predominates the whole of her sex. It was not that he felt any emotion akin to love for Irene Adler. All emotions, and that one particularly, were abhorrent to his cold, precise, but admirably balanced mind. He was, I take it, the most perfect reasoning and observing machine that the world has seen ; but, as a lover, he would have placed himself in a false position. He never spoke of the softer passions, save with a gibe and a sneer. They were admirable things for the observer — excellent for drawing the veil from men’s motives and actions. But for the trained reasoner to admit such intrusions into his own delicate and finely adjusted temperament was to introduce a distracting factor which might throw a doubt upon all his mental results. Grit in a sensitive instrument, or a crack in one of his own high-power lenses, would not be more disturbing than a strong emotion in a nature such as his. And yet there was but one woman to him, and that woman was the late Irene Adler, of dubious and questionable memory.</p>
</blockquote>
<h4>モデル別の翻訳結果</h4>
<p>モデルのコンテキストサイズは 8192 で統一。</p>
<h5>Qwen3 4B Instruct 2507 q8</h5>
<blockquote>
<p>シェルロック・ホームズにとって彼女は常に「その女性」として存在している。彼が彼女を他の名前で呼ぶことはほとんどない。彼の目には、彼女がすべての女性を覆い隠し、優勢に置く存在である。彼がアイレーン・アダーよりもどのような感情を感じたのかというと、愛のようなものではなく、むしろそのような感情は彼の冷たく正確で、素晴らしいバランスを持つ精神に対して嫌悪されていた。彼は、世界に見られる最高度の推論力と観察力を備えた存在であると言えるだろうが、恋人としての立場では間違いを犯している可能性がある。彼は、柔らかい情動について、たとえ笑いながらも軽蔑の眼差しで語るだけだ。それらは観察者にとって素晴らしいものであり、人間の動機や行動に覆い被さるものを剥がすのに適している。しかし、訓練された論理的思考を持つ者にとって、自分自身の鋭敏かつ精密な精神の中にそのような感情を導入することは、すべての心理的結論に疑問を投げかけるような「不純物」である。彼のような精神にとっては、感覚的な刺激が刃物のように切るほどの影響を与えるだろう。しかし、彼にとって女性はただ一人しか存在せず、その女性こそがかつてのアイレーン・アダーよりであり、記憶に疑問を呈する存在であった。</p>
</blockquote>
<h5>Gemma 3n E4B</h5>
<blockquote>
<p>シャーロック・ホームズにとって、彼女は常に「女性」そのものだった。彼が彼女を他の名前で呼ぶのを聞いたことはほとんどない。彼の目には、彼女は女性全体を凌駕し、圧倒していた。イレーン・アドラーに対して、彼が愛のような感情を抱いたからではない。感情、特にその感情は、彼の冷徹で正確、しかしバランスの取れた心には嫌悪感を抱かせるものだった。彼は、私が理解する限り、世界で見た中で最も完璧な推理と観察の機械だった。しかし、恋人としては、彼は不利な立場に立たされるだろう。彼は、柔らかい感情について、皮肉や嘲笑を交えて語ることはあっても、それらは軽蔑の対象だった。それらは観察者にとっては素晴らしいものであり、人々の動機や行動を明らかにするのに役立つ。しかし、訓練された論理家にとって、そのような感情を自分の繊細で洗練された気質に持ち込むことは、彼の精神的な結果に疑念を投げかける可能性のある、気を散らす要因となる。敏感な楽器の中の砂粒や、彼の高性能レンズのひび割れほど、彼の性質にとって、強い感情ほど混乱をもたらすことはないだろう。しかし、彼にとって唯一の女性は、記憶が曖昧で疑わしい、故イレーン・アドラーだった。</p>
</blockquote>
<h5>GPT-OSS 20B</h5>
<blockquote>
<p>シャーロック・ホームズにとって、彼女はいつも女性である。彼が彼女を他の名前で呼ぶことはめったに聞いたことがない。彼の目には、彼女は自らの性別全体を凌ぎ、支配している。彼がアイリーン・アドラーに対して愛に似た感情を抱いたわけではない。すべての感情、特にそれは、彼の冷徹で正確だが、驚くほどバランスの取れた心にとって嫌悪感を抱くものだった。彼は、私はそう思う、世界が目にした中で最も完璧な推論と観察の機械だった。しかし、恋人としてなら、彼は誤った立場に立つことになるだろう。彼は柔らかな情熱について語ることはなく、嘲笑と皮肉を伴っただけだった。それらは観察者にとって賞賛すべきものであり、人間の動機と行動の覆いを剥がすのに優れていた。しかし、訓練された理性者が自身の繊細で精密に調整された性格にこうした侵入を許すことは、彼の精神的結果全てに疑念を投げかけるような注意を引く要素を導入することに他ならない。敏感な器具に粒子が入ること、または自身の高倍率レンズにひびが入ることは、彼のような性質の中で強い感情が入るほどに迷惑だろう。にもかかわらず、彼にとって唯一の女性は、疑わしい記憶を持つ亡きアイリーン・アドラーだった。</p>
</blockquote>
<h5>参考：日本語訳</h5>
<p><a href="https://221b.jp/h/scan.html">コンプリート・シャーロック・ホームズ</a>にある和訳は以下の通り。</p>
<blockquote>
<p>シャーロックホームズにとって、彼女はいつも「あの女」である。別の呼び方をするのは、これまでほとんど聞いたことがない。彼女は、ホームズが「女」に分類した情報の手前に居座っているので「女」と言えばそれは彼女のことなのだ。しかし、彼はアイリーン・アドラーに愛のような激情はいっさい感じていなかった。すべての激情、とくに愛は、冷静沈着で、すばらしくバランスのとれた精緻な精神には置き場所がない。私の知る限り、彼はこれまで見たこともない、完璧な思考力と観察力をかねそなえた最高の機械だ。しかし人が人を愛するという観点から見ると、彼は間違った場所に立っていたことになるかもしれない。彼が愛を語るときは、決まって嘲笑的な批判が下される。観察機である彼にとって、心を揺り動かす激しい感情は、隠された動機や行動を分析するための、またとない観察対象だった。しかし、理詰めに作られている彼自身の心にそのようなものがまぎれこむことを許せば、完全調整済みの精巧な精神に、混乱の原因を招きいれ、推理で得た結論の信頼性がすべて損なわれる危険がある。彼のような性格の人間に、愛という衝動が混入すれば、繊細な実験器具に入ったチリや、高倍率レンズのひび割れなどとは比較にならないほど、壊滅的な結果になるはずだ。それにもかかわらず、ひとりの女が、観察機の中にいた。それが、誉れ高き、謎多き、故アイリーン・アドラーだったのだ。</p>
</blockquote>

  </article>
    </section>

<footer class="site-footer">
    <p>&copy; User </p>
</footer></body>
</html>